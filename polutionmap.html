<!DOCTYPE html>
<html lang="en">
 <head>
     <meta name="viewport" content="width=device-width; initial-scale=1.0">
    <meta charset="utf-8">
        <title>PoltavaAirCondition</title>
     <link rel="stylesheet" href="polutionmap.css">
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-  xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
   <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"> 

 </head>
 <body>
     <div class="content">

     <div class="map" id="mapid">
    </div>
     </div>
     
     <script src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
  
     <script>
     
         function Dayinf(){
         var dt = new Date()
            var days =      ["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"];
            $('#day').html(days[dt.getDay()]);
            var months =["Січень -","Лютий -","Березень -","Квітень -","Травень -","Червень -","Липень -","Серпень -","Вересень -","Жовтень -","Листопад -","Грудень -"];
            $('#date').html(months[dt.getMonth()] + " " + dt.getDate() + ", " +     dt.getFullYear());
            $('#time').html((dt.getHours()>12?(dt.getHours()-12):dt.getHours()).toString() +    ":" + ((dt.getMinutes() < 10 ? '0' : '').toString() + dt.getMinutes().toString()));
         
         };
     
        var mymap = L.map('mapid').setView([49.58951, 34.55071], 12.5);
         L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: '*************************'
         }).addTo(mymap);
         
         var legend = L.control({ position: "bottomleft" });
         
         legend.onAdd = function(mymap) {
            var div = L.DomUtil.create("div", "AQILEGEND");
            div.innerHTML += '<div class="unit">AQI PM2.5</div>';
            div.innerHTML += '<span class="l-0"><i></i><b>н/д</b></span>';
            div.innerHTML += '<span class="l-1"><i></i><b>0-50</b></span>';
            div.innerHTML += '<span class="l-2"><i></i><b>51-100</b><</span>';
            div.innerHTML += '<span class="l-3"><i></i><b>101-150</b>></span>';
            div.innerHTML += '<span class="l-4"><i></i><b>151-200</b></span>';
            div.innerHTML += '<span class="l-5"><i></i><b>201-300</b></span>';
            div.innerHTML += '<span class="l-6"><i></i><b>301+</b></span>';
             
            return div;
         };

         legend.addTo(mymap);
         
         var legend = L.control({ position: "topright" });
         
         legend.onAdd = function(mymap) {
            var div = L.DomUtil.create("button", "menu-open");
            div.innerHTML += '<a class="home-link" href="https://poltavaaircondition.online"><img src="free-icon-web-house-15730.svg" class="burger" alt="Open menu"></a>';
             
            return div;
         };

         legend.addTo(mymap);
         
         
         const contentString = 
         '<div class="widget-container">'+
            '<div class="top-left">'+
            '<h2 id="day">День</h2>'+
            '<h3 id="date">Місяць, число, рік</h3>'+
            '<h3 id="time">Час</h3>'+
            '<h3 id="time">Полтава, вул.Сако</h3>'+
            '<p class="geo"></p>'+
            '</div>'+
            '<div class="horizontal-half-divider"></div>'+
            '<div class="bottom-right">'+
            '<div class="other-details-key">'+
            '<p>PM2.5</p>'+
            '<p>CO2</p>'+
            '<p>Температура</p>'+
            '<p>Вологість</p>'+
            '</div>'+
            '<div class="other-details-values">'+
            '<p id="AQI">0 ppm</p>'+
            '<p id="CO2">0 ppm</p>'+
            '<p id="Temperature">0°C</p>'+
            '<p id="Humidity">0 %</p>'+
            '</div>'+
            '</div>';
         
         const contentString1 =
            '<div class="widget-container">'+
            '<div class="top-left">'+
            '<h2 id="day">День</h2>'+
            '<h3 id="date">Місяць, число, рік</h3>'+
            '<h3 id="time">Час</h3>'+
            '<h3 id="time">Полтава, вул.Зигіна</h3>'+
            '<p class="geo"></p>'+
            '</div>'+
            '<div class="horizontal-half-divider"></div>'+
            '<div class="bottom-right">'+
            '<div class="other-details-key">'+
            '<p>PM2.5</p>'+
            '<p>CO2</p>'+
            '<p>Температура</p>'+
            '<p>Вологість</p>'+
            '</div>'+
            '<div class="other-details-values">'+
            '<p id="AQI1">0 ppm</p>'+
            '<p id="CO21">0 ppm</p>'+
            '<p id="Temperature1">0 °C</p>'+
            '<p id="Humidity1">0 %</p>'+
            '</div>'+
            '</div>';
         
         
         var LeafIcon = L.Icon.extend({
            options: {
            iconSize:     [60, 65],
            shadowSize:   [40, 60],
            iconAnchor:   [22, 60],
            shadowAnchor: [4, 60],
            popupAnchor:  [7.5, -40]
            }
                });
         
         var greenIcon = new LeafIcon({
            iconUrl: "map-marker-svgrepo-com.svg",
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/images/marker-shadow.png'
            });
         
         function clickZoom(e) {
              mymap.flyTo(e.target.getLatLng(), 18);
            };
         var marker = L.marker([49.58461, 34.5877], {icon: greenIcon, autoPan: false}).addTo(mymap);
         marker.bindPopup(contentString).on('popupopen');
         
         var marker = L.marker([49.60064, 34.53081], {icon: greenIcon, autoPan: false}).addTo(mymap);
         marker.bindPopup(contentString1).on('popupopen');
         
      
        
        var myHeaders = new Headers();
            myHeaders.append('pragma', 'no-cache');
            myHeaders.append('cache-control', 'no-cache');
            
        var myInit = {
            method: 'GET',
            headers: myHeaders,
            };
        
        
        async function datatouser2(){
            Dayinf();
            
            const response2 = await fetch('sensor2.txt', myInit);
            const temphumr2 = await fetch('temphum.txt', myInit);
            var temphumd2 = await temphumr2.text();
            var data2 = await response2.text();
            console.log("Data!!! " + data2);
            
            var info2 = data2.split(":");
            var temphuminfo2 = temphumd2.split(":");
            
            var AQI2 = info2[0] * 4;
            var CO22 = info2[1] * 4;
            var Temperature2 = temphuminfo2[0];
            var Humidity2 = temphuminfo2[1];

            
            document.getElementById("AQI1").innerHTML = AQI2 + " " + "ppm";
            document.getElementById("CO21").innerHTML = CO22 + " " + "ppm";
            document.getElementById("Temperature1").innerHTML = Temperature2 + "°C";
            document.getElementById("Humidity1").innerHTML = Humidity2 + "%";
          
            
             if (AQI2 > 0  ||  AQI2 < 50){

                document.getElementById("AQI1").style.color = "#17a355";
            };
            
            if (AQI2 > 51 || AQI2 < 100){
                console.log("yes it is!!!!!!!!!!");
                document.getElementById("AQI1").style.color = "#e9d109";
            };
            
            if (AQI2 > 101 ){
                document.getElementById("AQI1").style.color= "#ea270d";
            };
            
            if(CO22 > 0  || CO22 <400){
                
                document.getElementById("CO21").style.color = "#17a355";
            };
            if (CO22 > 401 || CO22 <500){
                document.getElementById("CO21").style.color = "#e9d109";
            };
            if (CO22 > 501){
                document.getElementById("CO21").style.color= "#ea270d";
            };
            
            if(Humidity2 > 0  || Humidity2 < 50){
                
                document.getElementById("Humidity1").style.color = "#0530da";
            };
            if (Humidity2 > 70 || Humidity2 <100){
                document.getElementById("Humidity1").style.color = "#0606d0";
            };
            if (Humidity2 > 100){
                document.getElementById("Humidity1").style.color= "#0505a6";
            };
            
            if(Temperature2 > 0 ){
                
                document.getElementById("Temperature1").style.color = "#ea270d";
            };
            if (Temperature2 < 0){
                document.getElementById("Temperature1").style.color = "#0e96f8";
            };
           
        };
         
        async function datatouser(){
            Dayinf();
            
            const response = await fetch('sensor1.txt', myInit);
            const rextra = await fetch('sensor2.txt', myInit);
            const temphumr = await fetch('temphum.txt', myInit);
            var temphumd = await temphumr.text();
            var data = await response.text();
            var dataextra = await rextra.text();
            console.log(data);
            
            var info = data.split(":");
            var temphuminfo = temphumd.split(":");
            var extrainfo = dataextra.split(":");
            
            var AQI = info[0] * 4;
            var CO2 = extrainfo[1] * 4;
            var Temperature = temphuminfo[0];
            var Humidity = temphuminfo[1];
            
            
            document.getElementById("AQI").innerHTML = AQI + " " + "ppm";
            document.getElementById("CO2").innerHTML = CO2 + " " + "ppm";
            document.getElementById("Temperature").innerHTML = Temperature + "°C";
            document.getElementById("Humidity").innerHTML = Humidity + "%";
            
            if (AQI > 0  || AQI < 50){
                console.log("yes it is");
                document.getElementById("AQI").style.color = "#17a355";
            }
            
            else if (AQI > 51 || AQI < 100){
                console.log("yes it is!!!!!!!!!!");
                document.getElementById("AQI").style.color = "#e9d109";
            }
            
            else if (AQI > 101  || AQI < 150){
                document.getElementById("AQI").style.color= "#ea270d";
            }
            
            if(CO2 > 0  || CO2 <400){
                
                document.getElementById("CO2").style.color = "#17a355";
            }
            if (CO2 > 401 || CO2 <500){
                document.getElementById("CO2").style.color = "#e9d109";
            }
            if (CO2 > 501){
                document.getElementById("CO2").style.color= "#ea270d";
            }
            
            if(Humidity > 0  || Humidity < 50){
                
                document.getElementById("Humidity").style.color = "#0530da";
            }
            if (Humidity > 70 || Humidity <100){
                document.getElementById("Humidity").style.color = "#0606d0";
            }
            if (Humidity > 100){
                document.getElementById("Humidity").style.color= "#0505a6";
            }
            
            if(Temperature > 0 ){
                
                document.getElementById("Temperature").style.color = "#ea270d";
            }
            if (Temperature < 0){
                document.getElementById("Temperature").style.color = "#0e96f8";
            }
        };
         
 
        let timerId = setInterval(() => datatouser(), 2000);
        let timerId2 = setInterval(() => datatouser2(), 2000);
     
     </script>
 </body>
</html>
